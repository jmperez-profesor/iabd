
<!doctype html>
<html lang="es" class="no-js">
  <head>
    
      <meta charset="utf-8">
      <meta name="viewport" content="width=device-width,initial-scale=1">
      
        <meta name="description" content="Nmap, puertos, escáner, scanner, window, linux, scripts, opciones. Apuntes, teoría, prácticas, ejercicio del curso de especialización de ciberseguridad. IES severo ochoa Elche. Hacking ético. incidentes de seguridad, puesta en producción segura.">
      
      
      
        <link rel="canonical" href="https://jmperez-profesor.github.io/iabd/Seguridad_ofensiva/nmap101/">
      
      
      
      
      <link rel="icon" href="../../images/favicon.png">
      <meta name="generator" content="mkdocs-1.6.1, mkdocs-material-9.6.23">
    
    
      
        <title>Nmap básico - Inteligencia Artificial y Big Data</title>
      
    
    
      <link rel="stylesheet" href="../../assets/stylesheets/main.84d31ad4.min.css">
      
        
        <link rel="stylesheet" href="../../assets/stylesheets/palette.06af60db.min.css">
      
      


    
    
      
    
    
      
        
        
        <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
        <link rel="stylesheet" href="https://fonts.googleapis.com/css?family=Roboto:300,300i,400,400i,700,700i%7CRoboto+Mono:400,400i,700,700i&display=fallback">
        <style>:root{--md-text-font:"Roboto";--md-code-font:"Roboto Mono"}</style>
      
    
    
      <link rel="stylesheet" href="../../stylesheets/extra.css">
    
    <script>__md_scope=new URL("../..",location),__md_hash=e=>[...e].reduce(((e,_)=>(e<<5)-e+_.charCodeAt(0)),0),__md_get=(e,_=localStorage,t=__md_scope)=>JSON.parse(_.getItem(t.pathname+"."+e)),__md_set=(e,_,t=localStorage,a=__md_scope)=>{try{t.setItem(a.pathname+"."+e,JSON.stringify(_))}catch(e){}}</script>
    
      

    
    
    
  </head>
  
  
    
    
      
    
    
    
    
    <body dir="ltr" data-md-color-scheme="default" data-md-color-primary="light-green" data-md-color-accent="indigo">
  
    
    <input class="md-toggle" data-md-toggle="drawer" type="checkbox" id="__drawer" autocomplete="off">
    <input class="md-toggle" data-md-toggle="search" type="checkbox" id="__search" autocomplete="off">
    <label class="md-overlay" for="__drawer"></label>
    <div data-md-component="skip">
      
        
        <a href="#que-son-los-puertos" class="md-skip">
          Saltar a contenido
        </a>
      
    </div>
    <div data-md-component="announce">
      
    </div>
    
    
      

<header class="md-header" data-md-component="header">
  <nav class="md-header__inner md-grid" aria-label="Cabecera">
    <a href="https://jmperez-profesor.github.io/iabd/" title="Inteligencia Artificial y Big Data" class="md-header__button md-logo" aria-label="Inteligencia Artificial y Big Data" data-md-component="logo">
      
  <img src="../../images/logo.png" alt="logo">

    </a>
    <label class="md-header__button md-icon" for="__drawer">
      
      <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M3 6h18v2H3zm0 5h18v2H3zm0 5h18v2H3z"/></svg>
    </label>
    <div class="md-header__title" data-md-component="header-title">
      <div class="md-header__ellipsis">
        <div class="md-header__topic">
          <span class="md-ellipsis">
            Inteligencia Artificial y Big Data
          </span>
        </div>
        <div class="md-header__topic" data-md-component="header-topic">
          <span class="md-ellipsis">
            
              Nmap básico
            
          </span>
        </div>
      </div>
    </div>
    
      
        <form class="md-header__option" data-md-component="palette">
  
    
    
    
    <input class="md-option" data-md-color-media="" data-md-color-scheme="default" data-md-color-primary="light-green" data-md-color-accent="indigo"  aria-label="Cambiar a modo oscuro"  type="radio" name="__palette" id="__palette_0">
    
      <label class="md-header__button md-icon" title="Cambiar a modo oscuro" for="__palette_1" hidden>
        <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M17 6H7c-3.31 0-6 2.69-6 6s2.69 6 6 6h10c3.31 0 6-2.69 6-6s-2.69-6-6-6m0 10H7c-2.21 0-4-1.79-4-4s1.79-4 4-4h10c2.21 0 4 1.79 4 4s-1.79 4-4 4M7 9c-1.66 0-3 1.34-3 3s1.34 3 3 3 3-1.34 3-3-1.34-3-3-3"/></svg>
      </label>
    
  
    
    
    
    <input class="md-option" data-md-color-media="" data-md-color-scheme="slate" data-md-color-primary="teal" data-md-color-accent="indigo"  aria-label="Cambiar a modo normal"  type="radio" name="__palette" id="__palette_1">
    
      <label class="md-header__button md-icon" title="Cambiar a modo normal" for="__palette_0" hidden>
        <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M17 7H7a5 5 0 0 0-5 5 5 5 0 0 0 5 5h10a5 5 0 0 0 5-5 5 5 0 0 0-5-5m0 8a3 3 0 0 1-3-3 3 3 0 0 1 3-3 3 3 0 0 1 3 3 3 3 0 0 1-3 3"/></svg>
      </label>
    
  
</form>
      
    
    
      <script>var palette=__md_get("__palette");if(palette&&palette.color){if("(prefers-color-scheme)"===palette.color.media){var media=matchMedia("(prefers-color-scheme: light)"),input=document.querySelector(media.matches?"[data-md-color-media='(prefers-color-scheme: light)']":"[data-md-color-media='(prefers-color-scheme: dark)']");palette.color.media=input.getAttribute("data-md-color-media"),palette.color.scheme=input.getAttribute("data-md-color-scheme"),palette.color.primary=input.getAttribute("data-md-color-primary"),palette.color.accent=input.getAttribute("data-md-color-accent")}for(var[key,value]of Object.entries(palette.color))document.body.setAttribute("data-md-color-"+key,value)}</script>
    
    
    
      
      
        <label class="md-header__button md-icon" for="__search">
          
          <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M9.5 3A6.5 6.5 0 0 1 16 9.5c0 1.61-.59 3.09-1.56 4.23l.27.27h.79l5 5-1.5 1.5-5-5v-.79l-.27-.27A6.52 6.52 0 0 1 9.5 16 6.5 6.5 0 0 1 3 9.5 6.5 6.5 0 0 1 9.5 3m0 2C7 5 5 7 5 9.5S7 14 9.5 14 14 12 14 9.5 12 5 9.5 5"/></svg>
        </label>
        <div class="md-search" data-md-component="search" role="dialog">
  <label class="md-search__overlay" for="__search"></label>
  <div class="md-search__inner" role="search">
    <form class="md-search__form" name="search">
      <input type="text" class="md-search__input" name="query" aria-label="Búsqueda" placeholder="Búsqueda" autocapitalize="off" autocorrect="off" autocomplete="off" spellcheck="false" data-md-component="search-query" required>
      <label class="md-search__icon md-icon" for="__search">
        
        <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M9.5 3A6.5 6.5 0 0 1 16 9.5c0 1.61-.59 3.09-1.56 4.23l.27.27h.79l5 5-1.5 1.5-5-5v-.79l-.27-.27A6.52 6.52 0 0 1 9.5 16 6.5 6.5 0 0 1 3 9.5 6.5 6.5 0 0 1 9.5 3m0 2C7 5 5 7 5 9.5S7 14 9.5 14 14 12 14 9.5 12 5 9.5 5"/></svg>
        
        <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M20 11v2H8l5.5 5.5-1.42 1.42L4.16 12l7.92-7.92L13.5 5.5 8 11z"/></svg>
      </label>
      <nav class="md-search__options" aria-label="Buscar">
        
        <button type="reset" class="md-search__icon md-icon" title="Limpiar" aria-label="Limpiar" tabindex="-1">
          
          <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M19 6.41 17.59 5 12 10.59 6.41 5 5 6.41 10.59 12 5 17.59 6.41 19 12 13.41 17.59 19 19 17.59 13.41 12z"/></svg>
        </button>
      </nav>
      
    </form>
    <div class="md-search__output">
      <div class="md-search__scrollwrap" tabindex="0" data-md-scrollfix>
        <div class="md-search-result" data-md-component="search-result">
          <div class="md-search-result__meta">
            Inicializando búsqueda
          </div>
          <ol class="md-search-result__list" role="presentation"></ol>
        </div>
      </div>
    </div>
  </div>
</div>
      
    
    
  </nav>
  
</header>
    
    <div class="md-container" data-md-component="container">
      
      
        
          
            
<nav class="md-tabs" aria-label="Pestañas" data-md-component="tabs">
  <div class="md-grid">
    <ul class="md-tabs__list">
      
        
  
  
  
  
    <li class="md-tabs__item">
      <a href="../.." class="md-tabs__link">
        
  
  
    
  
  Introducción

      </a>
    </li>
  

      
        
  
  
  
  
    
    
      <li class="md-tabs__item">
        <a href="../../hf/" class="md-tabs__link">
          
  
  
    
  
  Hugging Face

        </a>
      </li>
    
  

      
        
  
  
  
  
    
    
      <li class="md-tabs__item">
        <a href="../../Datasets/Datasets/" class="md-tabs__link">
          
  
  
    
  
  Datasets

        </a>
      </li>
    
  

      
    </ul>
  </div>
</nav>
          
        
      
      <main class="md-main" data-md-component="main">
        <div class="md-main__inner md-grid">
          
            
              
              <div class="md-sidebar md-sidebar--primary" data-md-component="sidebar" data-md-type="navigation" >
                <div class="md-sidebar__scrollwrap">
                  <div class="md-sidebar__inner">
                    


  


  

<nav class="md-nav md-nav--primary md-nav--lifted md-nav--integrated" aria-label="Navegación" data-md-level="0">
  <label class="md-nav__title" for="__drawer">
    <a href="https://jmperez-profesor.github.io/iabd/" title="Inteligencia Artificial y Big Data" class="md-nav__button md-logo" aria-label="Inteligencia Artificial y Big Data" data-md-component="logo">
      
  <img src="../../images/logo.png" alt="logo">

    </a>
    Inteligencia Artificial y Big Data
  </label>
  
  <ul class="md-nav__list" data-md-scrollfix>
    
      
      
  
  
  
  
    <li class="md-nav__item">
      <a href="../.." class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    Introducción
    
  </span>
  

      </a>
    </li>
  

    
      
      
  
  
  
  
    
    
      
        
          
        
      
        
      
        
      
        
      
    
    
    
      
      
    
    
    <li class="md-nav__item md-nav__item--nested">
      
        
        
          
        
        <input class="md-nav__toggle md-toggle md-toggle--indeterminate" type="checkbox" id="__nav_2" >
        
          
          <div class="md-nav__link md-nav__container">
            <a href="../../hf/" class="md-nav__link ">
              
  
  
  <span class="md-ellipsis">
    Hugging Face
    
  </span>
  

            </a>
            
              
              <label class="md-nav__link " for="__nav_2" id="__nav_2_label" tabindex="0">
                <span class="md-nav__icon md-icon"></span>
              </label>
            
          </div>
        
        <nav class="md-nav" data-md-level="1" aria-labelledby="__nav_2_label" aria-expanded="false">
          <label class="md-nav__title" for="__nav_2">
            <span class="md-nav__icon md-icon"></span>
            Hugging Face
          </label>
          <ul class="md-nav__list" data-md-scrollfix>
            
              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../hf/Ejemplo_gradio/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    Gradio
    
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    
    
      
        
      
    
    
    
      
      
    
    
    <li class="md-nav__item md-nav__item--nested">
      
        
        
          
        
        <input class="md-nav__toggle md-toggle md-toggle--indeterminate" type="checkbox" id="__nav_2_3" >
        
          
          <label class="md-nav__link" for="__nav_2_3" id="__nav_2_3_label" tabindex="0">
            
  
  
  <span class="md-ellipsis">
    Tasks
    
  </span>
  

            <span class="md-nav__icon md-icon"></span>
          </label>
        
        <nav class="md-nav" data-md-level="2" aria-labelledby="__nav_2_3_label" aria-expanded="false">
          <label class="md-nav__title" for="__nav_2_3">
            <span class="md-nav__icon md-icon"></span>
            Tasks
          </label>
          <ul class="md-nav__list" data-md-scrollfix>
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../hf/Tasks_vc/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    Visión por computador
    
  </span>
  

      </a>
    </li>
  

              
            
          </ul>
        </nav>
      
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../hf/Referencias/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    Referencias
    
  </span>
  

      </a>
    </li>
  

              
            
          </ul>
        </nav>
      
    </li>
  

    
      
      
  
  
  
  
    
    
      
        
      
        
      
        
      
    
    
    
      
      
    
    
    <li class="md-nav__item md-nav__item--nested">
      
        
        
          
        
        <input class="md-nav__toggle md-toggle md-toggle--indeterminate" type="checkbox" id="__nav_3" >
        
          
          <label class="md-nav__link" for="__nav_3" id="__nav_3_label" tabindex="0">
            
  
  
  <span class="md-ellipsis">
    Datasets
    
  </span>
  

            <span class="md-nav__icon md-icon"></span>
          </label>
        
        <nav class="md-nav" data-md-level="1" aria-labelledby="__nav_3_label" aria-expanded="false">
          <label class="md-nav__title" for="__nav_3">
            <span class="md-nav__icon md-icon"></span>
            Datasets
          </label>
          <ul class="md-nav__list" data-md-scrollfix>
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../Datasets/Datasets/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    Datasets de Hugging Face
    
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../Datasets/datasets_aitor/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    Cargando datasets en HuggingFace (apuntes de Aitor Medrano)
    
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    
    
      
        
      
    
    
    
      
      
    
    
    <li class="md-nav__item md-nav__item--nested">
      
        
        
          
        
        <input class="md-nav__toggle md-toggle md-toggle--indeterminate" type="checkbox" id="__nav_3_3" >
        
          
          <label class="md-nav__link" for="__nav_3_3" id="__nav_3_3_label" tabindex="0">
            
  
  
  <span class="md-ellipsis">
    Actividades
    
  </span>
  

            <span class="md-nav__icon md-icon"></span>
          </label>
        
        <nav class="md-nav" data-md-level="2" aria-labelledby="__nav_3_3_label" aria-expanded="false">
          <label class="md-nav__title" for="__nav_3_3">
            <span class="md-nav__icon md-icon"></span>
            Actividades
          </label>
          <ul class="md-nav__list" data-md-scrollfix>
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../Datasets/Actividad1/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    Actividad 1 - Datasets de Hugging Face
    
  </span>
  

      </a>
    </li>
  

              
            
          </ul>
        </nav>
      
    </li>
  

              
            
          </ul>
        </nav>
      
    </li>
  

    
  </ul>
</nav>
                  </div>
                </div>
              </div>
            
            
          
          
            <div class="md-content" data-md-component="content">
              <article class="md-content__inner md-typeset">
                
                  



  <h1>Nmap básico</h1>

<h2 id="que-son-los-puertos">¿Qué son los puertos?</h2>
<p>Ya hemos comentado que Nmap es el estándar de facto a la hora de realizar un escáner de puertos pero... ¿qué entendemos por puertos?</p>
<p>En los sistemas operativos modernos, los puertos son direcciones numeradas para el tráfico de red. Los diferentes tipos de servicios utilizan diferentes puertos de forma predeterminada.</p>
<p>Por ejemplo, el tráfico web normal usa el puerto 80, mientras que el correo electrónico POP3 usa el puerto 110. Una de las formas en que funciona un firewall es permitiendo o restringiendo el tráfico a través de un puerto en particular.</p>
<p>Dado que la configuración del puerto puede suponer un riesgo para la seguridad, es fundamental saber qué puertos están abiertos y cuáles están bloqueados.</p>
<h2 id="que-es-un-escaner-de-puertos">¿Qué es un escáner de puertos?</h2>
<p>Esta es una herramienta que se utiliza para descubrir y auditar redes, escanear y verificar vulnerabilidades en direcciones y puertos de Protocolo de Internet (IP) para una red determinada.</p>
<p>Es usado por el administrador de red, gerente de TI o simplemente un profesional de seguridad de la empresa. Uno de los desafíos críticos que enfrentarán estos perfiles es batallar para saber qué se está ejecutando en su red y el tipo de problemas/desafíos de seguridad que plantean.</p>
<p>Hay varias herramientas (incluido Nmap) disponibles para que los administradores de red las usen para monitorear su red y obtener actividades en tiempo real en su red:</p>
<p>Con Nmap:</p>
<ul>
<li>Los administradores de red pueden identificar todos los dispositivos que se ejecutan o acceden a sus sistemas.</li>
<li>Un administrador puede identificar todos los hosts, equipos conectados a su red, así como los servicios que ofrecen.</li>
<li>Un administrador puede escanear todos los puertos abiertos, dando prioridad a la seguridad, es decir, las detecciones de amenazas a la seguridad.</li>
<li>Un administrador puede escanear/monitorear un solo host o miles de dispositivos conectados.</li>
</ul>
<p>Como se ha indicado al principio, Nmap es, con mucho, la herramienta de escaneo de red más utilizada. Es una herramienta de escaneo de puertos, lo que significa que recopila información de estos puertos. </p>
<p>Nmap puede escuchar las respuestas de los sistemas y así determinar si un puerto está abierto, cerrado o filtrado de una forma u otra por el firewall (un sistema diseñado para denegar el acceso de usuarios no autorizados hacia o desde una red privada).</p>
<p>Es una herramienta flexible y versátil, lo que significa que puede adaptarse a diferentes actividades y funciones.</p>
<p>!!!Note "Nota"
    El escaneo de puertos también se puede denominar enumeración o descubrimiento de puertos. Usaremos estos términos indistintamente, que significan lo mismo.</p>
<p>Tal y como podemos leer en el propio site de <a href="https://nmap.org/book/intro.html">Nmap</a>:</p>
<p>!!!quote "Cita"
    Nmap utiliza paquetes IP sin procesar de formas novedosas para determinar qué hosts están disponibles en la red, qué servicios (nombre y versión de la aplicación) ofrecen esos hosts, qué sistemas operativos (y versiones de SO) están ejecutando, qué tipo de filtros de paquetes/firewalls están en uso y decenas de otras características.</p>
<div class="language-text highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal">1</span></pre></div></td><td class="code"><div><pre><span></span><code>Fue diseñado para escanear rápidamente redes grandes, pero funciona bien contra hosts únicos. Nmap se ejecuta en todos los principales sistemas operativos de computadoras, y están disponibles versiones gráficas y de consola.
</code></pre></div></td></tr></table></div>
<h2 id="windows-o-linux">Windows o Linux</h2>
<p>Nmap se desarrolló inicialmente para ejecutarse solo en sistemas basados en Unix. La versión de Windows se lanzó en 2000, pero actualmente cuenta con algunas limitaciones que incluyen:</p>
<ul>
<li>No se pueden realizar escaneos tan en profundidad como en un sistema Unix (por ejemplo puede haber problemas con clientes VPN)</li>
<li>No se puede escanear la propia máquina </li>
<li>Los escaneos en Windows, por la manera que tiene de formar los paquetes, puede resultar un poco más lenta en algunos casos</li>
</ul>
<p>!!!Info "Info"
    Por lo tanto, se recomienda el uso de Nmap en Linux por una mayor rapidez, eficiencia y experiencia de uso.</p>
<div class="language-text highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal">1</span>
<span class="normal">2</span>
<span class="normal">3</span></pre></div></td><td class="code"><div><pre><span></span><code>Es posible instalar la interfaz gráfica &quot;Zenmap&quot; como frontend de Nmap aunque en este curso únicamente veremos su manejo en línea de comandos en Linux.

Este curso no cubre el proceso de instalación de ninguna de las dos herramientas en ninguno de los dos SSOO ya que se da por sabido este proceso.
</code></pre></div></td></tr></table></div>
<h2 id="como-es-una-cabecera-tcp">¿Cómo es una cabecera TCP?</h2>
<p><img alt="" src="../img/CabeceraTCP.png" /></p>
<h2 id="que-es-el-3-way-handshake">¿Qué es el 3-way-handshake?</h2>
<p>El <strong>3-way handshake</strong> (o <strong>apretón de manos de tres vías</strong>) es el proceso utilizado en el protocolo <strong>TCP</strong> (Transmission Control Protocol) para establecer una conexión confiable entre un cliente y un servidor antes de transmitir datos. Este proceso es clave para garantizar que ambas partes estén listas para enviar y recibir datos, y que la conexión sea confiable.</p>
<h3 id="proceso-del-3-way-handshake">Proceso del <strong>3-way handshake</strong>:</h3>
<ol>
<li><strong>SYN (Solicitud de sincronización)</strong>:<ul>
<li>El cliente inicia la conexión enviando un segmento TCP con el <strong>flag SYN</strong> activado.</li>
<li>El segmento incluye un número de secuencia (sequence number), que en este caso será un valor inicial (digamos, <code>seq = x</code>).</li>
</ul>
</li>
</ol>
<p><strong>Propósito</strong>: El cliente informa al servidor que quiere iniciar una comunicación y establece su número de secuencia.</p>
<ol>
<li><strong>SYN-ACK (Sincronización y reconocimiento)</strong>:<ul>
<li>El servidor recibe el mensaje SYN del cliente y responde con un segmento que tiene dos flags activados: <strong>SYN</strong> y <strong>ACK</strong>.</li>
<li>El <strong>SYN</strong> indica que el servidor también quiere sincronizar la conexión, y el <strong>ACK</strong> es para confirmar que recibió correctamente el SYN del cliente.</li>
<li>El servidor envía su propio número de secuencia (<code>seq = y</code>) y reconoce el número de secuencia del cliente con un <strong>acknowledgment number</strong> (por ejemplo, <code>ack = x + 1</code>).</li>
</ul>
</li>
</ol>
<p><strong>Propósito</strong>: El servidor confirma que recibió la solicitud del cliente y envía su propio número de secuencia para la sincronización.</p>
<ol>
<li><strong>ACK (Confirmación del cliente)</strong>:<ul>
<li>El cliente recibe el segmento <strong>SYN-ACK</strong> del servidor y responde con un segmento <strong>ACK</strong>.</li>
<li>Este segmento contiene el <strong>acknowledgment number</strong> (<code>ack = y + 1</code>), que confirma que recibió el número de secuencia del servidor.</li>
</ul>
</li>
</ol>
<p><strong>Propósito</strong>: El cliente confirma que ha recibido el SYN del servidor, y la conexión se establece.</p>
<p>Una vez que el <strong>3-way handshake</strong> se ha completado, la conexión está completamente establecida y se pueden intercambiar datos de manera confiable.</p>
<h3 id="explicacion-grafica">Explicación gráfica</h3>
<p>A continuación te describo cómo se verían las tres fases del 3-way handshake. Aunque no puedo insertar imágenes directamente, te puedo describir cómo podrías visualizarlo:</p>
<h4 id="paso-1-cliente-envia-syn">Paso 1: Cliente envía SYN</h4>
<pre><code>Cliente                       Servidor
   |                              |
   | --- [SYN, seq = x] ---&gt;      |
   |                              |
</code></pre>
<ul>
<li>El cliente envía un paquete SYN con el número de secuencia <code>x</code>.</li>
</ul>
<h4 id="paso-2-servidor-responde-con-syn-ack">Paso 2: Servidor responde con SYN-ACK</h4>
<pre><code>Cliente                                    Servidor
   |                                           |
   | --- [SYN, seq = x] ---&gt;                   |
   |                                           |
   | &lt;--- [SYN, ACK, seq = y, ack = x + 1] --- |
   |                                           |
</code></pre>
<ul>
<li>El servidor responde con un SYN y ACK, reconociendo el número de secuencia del cliente (con <code>ack = x + 1</code>) y enviando su propio número de secuencia (<code>seq = y</code>).</li>
</ul>
<h4 id="paso-3-cliente-responde-con-ack">Paso 3: Cliente responde con ACK</h4>
<pre><code>Cliente                                     Servidor
   |                                            |
   | --- [SYN, seq = x] ---&gt;                    |
   |                                            |
   | &lt;--- [SYN, ACK, seq = y, ack = x + 1] ---  |
   |                                            |
   | --- [ACK, ack = y + 1] ---&gt;                |
   |                                            |
</code></pre>
<ul>
<li>El cliente envía el último paquete, un <strong>ACK</strong> que confirma el número de secuencia del servidor (<code>ack = y + 1</code>).</li>
</ul>
<p>Con esto, la conexión TCP está establecida y lista para transmitir datos.</p>
<hr />
<h3 id="resumen">Resumen</h3>
<ol>
<li><strong>SYN</strong>: El cliente dice "Quiero iniciar una conexión, este es mi número de secuencia."</li>
<li><strong>SYN-ACK</strong>: El servidor responde "Confirmo que recibí tu solicitud, aquí está mi número de secuencia."</li>
<li><strong>ACK</strong>: El cliente responde "He recibido tu número de secuencia, comencemos a enviar datos."</li>
</ol>
<h3 id="concepto-clave">Concepto clave</h3>
<ul>
<li>El intercambio de números de secuencia y <strong>acknowledgments</strong> (confirmaciones) asegura que ambos lados saben qué datos han sido enviados y recibidos, permitiendo que la transmisión de información sea confiable y ordenada. </li>
</ul>
<h2 id="uso-de-nmap">Uso de Nmap</h2>
<p>Podemos ver la infinidad de opciones que nos ofrece Nmap simplemente escribiendo <code>$ nmap</code> en el terminal:</p>
<p><img alt="" src="../img/nmap_opciones.png" />{: style="height:600px;width:500px"}</p>
<p>Existen un <a href="https://nmap.org/book/scan-methods.html">sinfín de técnicas y algoritmos de escaneo en Nmap</a>, así como otras tantas opciones a aplicar a estos escaneos. Es imposible cubrirlo todo en este curso por lo que sólo nombraremos los aspectos más importantes y queda a discrección del alumno profundizar más.</p>
<p>Output completo:</p>
<pre><code class="language-sh">map 7.94SVN ( https://nmap.org )
Usage: nmap [Scan Type(s)] [Options] {target specification}
TARGET SPECIFICATION:
  Can pass hostnames, IP addresses, networks, etc.
  Ex: scanme.nmap.org, microsoft.com/24, 192.168.0.1; 10.0.0-255.1-254
  -iL &lt;inputfilename&gt;: Input from list of hosts/networks
  -iR &lt;num hosts&gt;: Choose random targets
  --exclude &lt;host1[,host2][,host3],...&gt;: Exclude hosts/networks
  --excludefile &lt;exclude_file&gt;: Exclude list from file
HOST DISCOVERY:
  -sL: List Scan - simply list targets to scan
  -sn: Ping Scan - disable port scan
  -Pn: Treat all hosts as online -- skip host discovery
  -PS/PA/PU/PY[portlist]: TCP SYN/ACK, UDP or SCTP discovery to given ports
  -PE/PP/PM: ICMP echo, timestamp, and netmask request discovery probes
  -PO[protocol list]: IP Protocol Ping
  -n/-R: Never do DNS resolution/Always resolve [default: sometimes]
  --dns-servers &lt;serv1[,serv2],...&gt;: Specify custom DNS servers
  --system-dns: Use OS's DNS resolver
  --traceroute: Trace hop path to each host
SCAN TECHNIQUES:
  -sS/sT/sA/sW/sM: TCP SYN/Connect()/ACK/Window/Maimon scans
  -sU: UDP Scan
  -sN/sF/sX: TCP Null, FIN, and Xmas scans
  --scanflags &lt;flags&gt;: Customize TCP scan flags
  -sI &lt;zombie host[:probeport]&gt;: Idle scan
  -sY/sZ: SCTP INIT/COOKIE-ECHO scans
  -sO: IP protocol scan
  -b &lt;FTP relay host&gt;: FTP bounce scan
PORT SPECIFICATION AND SCAN ORDER:
  -p &lt;port ranges&gt;: Only scan specified ports
    Ex: -p22; -p1-65535; -p U:53,111,137,T:21-25,80,139,8080,S:9
  --exclude-ports &lt;port ranges&gt;: Exclude the specified ports from scanning
  -F: Fast mode - Scan fewer ports than the default scan
  -r: Scan ports sequentially - don't randomize
  --top-ports &lt;number&gt;: Scan &lt;number&gt; most common ports
  --port-ratio &lt;ratio&gt;: Scan ports more common than &lt;ratio&gt;
SERVICE/VERSION DETECTION:
  -sV: Probe open ports to determine service/version info
  --version-intensity &lt;level&gt;: Set from 0 (light) to 9 (try all probes)
  --version-light: Limit to most likely probes (intensity 2)
  --version-all: Try every single probe (intensity 9)
  --version-trace: Show detailed version scan activity (for debugging)
SCRIPT SCAN:
  -sC: equivalent to --script=default
  --script=&lt;Lua scripts&gt;: &lt;Lua scripts&gt; is a comma separated list of
           directories, script-files or script-categories
  --script-args=&lt;n1=v1,[n2=v2,...]&gt;: provide arguments to scripts
  --script-args-file=filename: provide NSE script args in a file
  --script-trace: Show all data sent and received
  --script-updatedb: Update the script database.
  --script-help=&lt;Lua scripts&gt;: Show help about scripts.
           &lt;Lua scripts&gt; is a comma-separated list of script-files or
           script-categories.
OS DETECTION:
  -O: Enable OS detection
  --osscan-limit: Limit OS detection to promising targets
  --osscan-guess: Guess OS more aggressively
TIMING AND PERFORMANCE:
  Options which take &lt;time&gt; are in seconds, or append 'ms' (milliseconds),
  's' (seconds), 'm' (minutes), or 'h' (hours) to the value (e.g. 30m).
  -T&lt;0-5&gt;: Set timing template (higher is faster)
  --min-hostgroup/max-hostgroup &lt;size&gt;: Parallel host scan group sizes
  --min-parallelism/max-parallelism &lt;numprobes&gt;: Probe parallelization
  --min-rtt-timeout/max-rtt-timeout/initial-rtt-timeout &lt;time&gt;: Specifies
      probe round trip time.
  --max-retries &lt;tries&gt;: Caps number of port scan probe retransmissions.
  --host-timeout &lt;time&gt;: Give up on target after this long
  --scan-delay/--max-scan-delay &lt;time&gt;: Adjust delay between probes
  --min-rate &lt;number&gt;: Send packets no slower than &lt;number&gt; per second
  --max-rate &lt;number&gt;: Send packets no faster than &lt;number&gt; per second
FIREWALL/IDS EVASION AND SPOOFING:
  -f; --mtu &lt;val&gt;: fragment packets (optionally w/given MTU)
  -D &lt;decoy1,decoy2[,ME],...&gt;: Cloak a scan with decoys
  -S &lt;IP_Address&gt;: Spoof source address
  -e &lt;iface&gt;: Use specified interface
  -g/--source-port &lt;portnum&gt;: Use given port number
  --proxies &lt;url1,[url2],...&gt;: Relay connections through HTTP/SOCKS4 proxies
  --data &lt;hex string&gt;: Append a custom payload to sent packets
  --data-string &lt;string&gt;: Append a custom ASCII string to sent packets
  --data-length &lt;num&gt;: Append random data to sent packets
  --ip-options &lt;options&gt;: Send packets with specified ip options
  --ttl &lt;val&gt;: Set IP time-to-live field
  --spoof-mac &lt;mac address/prefix/vendor name&gt;: Spoof your MAC address
  --badsum: Send packets with a bogus TCP/UDP/SCTP checksum
OUTPUT:
  -oN/-oX/-oS/-oG &lt;file&gt;: Output scan in normal, XML, s|&lt;rIpt kIddi3,
     and Grepable format, respectively, to the given filename.
  -oA &lt;basename&gt;: Output in the three major formats at once
  -v: Increase verbosity level (use -vv or more for greater effect)
  -d: Increase debugging level (use -dd or more for greater effect)
  --reason: Display the reason a port is in a particular state
  --open: Only show open (or possibly open) ports
  --packet-trace: Show all packets sent and received
  --iflist: Print host interfaces and routes (for debugging)
  --append-output: Append to rather than clobber specified output files
  --resume &lt;filename&gt;: Resume an aborted scan
  --noninteractive: Disable runtime interactions via keyboard
  --stylesheet &lt;path/URL&gt;: XSL stylesheet to transform XML output to HTML
  --webxml: Reference stylesheet from Nmap.Org for more portable XML
  --no-stylesheet: Prevent associating of XSL stylesheet w/XML output
MISC:
  -6: Enable IPv6 scanning
  -A: Enable OS detection, version detection, script scanning, and traceroute
  --datadir &lt;dirname&gt;: Specify custom Nmap data file location
  --send-eth/--send-ip: Send using raw ethernet frames or IP packets
  --privileged: Assume that the user is fully privileged
  --unprivileged: Assume the user lacks raw socket privileges
  -V: Print version number
  -h: Print this help summary page.
EXAMPLES:
  nmap -v -A scanme.nmap.org
  nmap -v -sn 192.168.0.0/16 10.0.0.0/8
  nmap -v -iR 10000 -Pn -p 80
SEE THE MAN PAGE (https://nmap.org/book/man.html) FOR MORE OPTIONS AND EXAMPLES
</code></pre>
<h3 id="tipos-de-escaneos">Tipos de escaneos</h3>
<h4 id="antes-de-nada-recordatorio-del-3-way-handshake">Antes de nada: recordatorio del 3-way-handshake</h4>
<p>Primero, un poco de antecedentes. Durante la comunicación con un servicio TCP, se establece una única conexión con el protocolo de enlace de 3 vías de TCP. Esto implica un <code>SYN</code> enviado a un puerto abierto TCP que tiene un servicio vinculado a él, ejemplos típicos son HTTP (puerto 80), SMTP (puerto 25), POP3 (puerto 110) o SSH (puerto 22).</p>
<p>En el lado del servidor ser verá un <code>SYN</code> y se responderá con <code>SYN ACK</code>, y el cliente responderá <code>SYN ACK</code> con un <code>ACK</code>. Esto completa la configuración y ahora se puede realizar el intercambio de datos.</p>
<p><img alt="" src="../img/3way.png" /></p>
<p>En este ejemplo, el firewall pasa el tráfico al servidor web (HTTP -&gt; 80) y el servidor web responde con el acuse de recibo.</p>
<p>En todos estos ejemplos, un firewall podría ser un dispositivo de hardware independiente o podría ser un firewall de software local en la computadora host.</p>
<h4 id="escaneo-tcp-syn-ss">Escaneo TCP SYN (-sS)</h4>
<p>El análisis SYN es la opción de análisis predeterminada y más popular, por buenas razones. Se puede realizar rápidamente, escaneando miles de puertos por segundo en una red rápida no obstaculizada por firewalls restrictivos.</p>
<p>También es relativamente discreto y sigiloso, ya que nunca completa las conexiones TCP.</p>
<p>Características:</p>
<ul>
<li>Rápido</li>
<li>Relativamente sigiloso</li>
<li>Requiere privilegios </li>
</ul>
<pre><code class="language-sh">$nmap -sS objetivo
</code></pre>
<h4 id="escaneo-tcp-connect-st">Escaneo TCP connect (-sT)</h4>
<p>El escaneo de conexión TCP es el tipo de escaneo TCP predeterminado cuando el escaneo SYN no es una opción. Este es el caso cuando un usuario no tiene privilegios para fabricar mensajes a medida con los flags necesarios.</p>
<p>En lugar de escribir paquetes sin procesar como hacen la mayoría de los otros tipos de escaneo, Nmap le pide al sistema operativo subyacente que establezca una conexión con la máquina y el puerto de destino emitiendo la llamada al sistema de conexión.</p>
<pre><code class="language-sh">$nmap -sT objetivo
</code></pre>
<p>Características: </p>
<ul>
<li>Confía en el sistema operativo</li>
<li>Más lento que TCP-SYN-Scan</li>
</ul>
<h4 id="escaneos-udp-su">Escaneos UDP (-sU)</h4>
<p>Si bien los servicios más populares en Internet se ejecutan sobre el protocolo TCP, los servicios UDP se implementan ampliamente. DNS, SNMP y DHCP (puertos registrados 53, 161/162 y 67/68) son tres de los más comunes. </p>
<p>Debido a que el escaneo UDP es generalmente más lento y más difícil que TCP, algunos auditores de seguridad ignoran estos puertos. Esto es un error, ya que los servicios UDP explotables son bastante comunes y los atacantes ciertamente no ignoran todo el protocolo.</p>
<pre><code class="language-sh">$nmap -sU objetivo
</code></pre>
<p>Características:</p>
<ul>
<li>Lento</li>
<li>Poco fiable</li>
</ul>
<h4 id="tcp-null-scan-sn">TCP Null scan (-sN)</h4>
<p>En los TCP Null Scans, los paquetes TCP enviados no tienen ninguna de las flags TCP establecidas.</p>
<p>Según el RFC, ante tal circunstancia, el objetivo debe responder con un RST si el puerto está cerrado</p>
<pre><code class="language-sh">$nmap -sN objetivo
</code></pre>
<h4 id="tcp-fin-scan-sf">TCP FIN scan (-sF)</h4>
<p>Esto es muy similar al anterior, excepto por el hecho de que en lugar de enviar un paquete TCP completamente vacío, envía un paquete con el flag FIN establecido que se usa para cerrar una conexión ordenadamente.</p>
<p>En consecuencia, el objetivo debe responder con un RST para puertos cerrados según RFC.</p>
<pre><code class="language-sh">$nmap -sF objetivo
</code></pre>
<h4 id="tcp-xmas-scan-sx">TCP Xmas scan (-sX)</h4>
<p>TCP Xmas Scans también es muy similar a las dos últimas técnicas de escaneo, excepto por el hecho de que utilizan paquetes TCP con los flags PSH, URG y FIN configurados.</p>
<p>Como los dos últimos tipos de escaneo, esto también espera paquetes RST para puertos cerrados bajo RFC.</p>
<pre><code class="language-sh">$nmap -sX objetivo
</code></pre>
<h3 id="estados-de-los-puertos-escaneados">Estados de los puertos escaneados</h3>
<p>Tras realizar el escaneo de puertos, se nos pueden reportar cuatro posibles estados de los mismos:</p>
<ul>
<li>
<p><strong>open</strong>: El puerto responde activamente a las conexiones entrantes</p>
</li>
<li>
<p><strong>open | filtered</strong>: cuando no se recibe respuesta, el puerto se clasifica así porque "ninguna respuesta" puede significar sólo dos cosas:</p>
<ul>
<li>El puerto esta abierto (en algunos tipos de escaneos no se recibe respuesta al SYN)</li>
<li>El puerto está protegido detrás de un firewall, por lo que se filtra</li>
</ul>
</li>
<li>
<p><strong>filtered</strong>: cuando el puerto está protegido detrás de un firewall que envía un ping ICMP de vuelta </p>
</li>
<li>
<p><strong>closed</strong>: cuando se recibe un paquete RST</p>
</li>
</ul>
<h4 id="puertos-filtrados-o-bloqueados">Puertos filtrados o bloqueados</h4>
<p>El trabajo de un firewall es proteger un sistema de paquetes no deseados que podrían dañarlo. En este ejemplo simple, el escaneo de puertos se realiza en el puerto 81, ya que no hay ningún servicio ejecutándose en este puerto, por lo que la mejor práctica es usar un firewall para bloquear el acceso.</p>
<p>Un <code>filtered</code> port como resultado de Nmap indica que el puerto no ha respondido en absoluto. El SYN simplemente ha sido descartado por el firewall. </p>
<p><img alt="" src="../img/firewall-filtered-port.png" /></p>
<h4 id="puertos-cerrados-o-cuando-falla-el-firewall">Puertos cerrados o cuando falla el Firewall</h4>
<p>En este caso, el resultado <code>closed</code> más común indica que no hay ningún servicio ejecutándose en el puerto, pero el firewall ha permitido que la conexión pase al servidor. También puede significar que no hay ningún firewall presente.</p>
<p>Se debe tener en cuenta que aunque se presentan los escenarios más comunes, es posible configurar un firewall para rechazar paquetes en lugar de descartarlos. Esto significaría que los paquetes que lleguen al firewall se verán cerrados (el firewall responde con RST ACK).</p>
<p>A continuación se muestra un caso en el que una regla de firewall permite el paso del paquete en el puerto 81 aunque no haya ningún servicio escuchando en el puerto. Lo más probable es que esto se deba a que el firewall está mal configurado.</p>
<p><img alt="" src="../img/firewall-closed-port.png" /></p>
<h4 id="puertos-abiertos">Puertos abiertos</h4>
<p>Cuando de algún puerto se indica el resultado <code>Open</code> en principio se trata de algún servicio expuesto al público que está accesible.</p>
<p>Un detalle interesante a notar es el <code>RST</code>  enviado después de aceptar el <code>SYN ACK</code> desde el servidor web. El <code>RST</code> es enviado por Nmap ya que el estado del puerto (abierto) ha sido determinado por el <code>SYN ACK</code>. Si estuviéramos buscando más información como la versión del servicio HTTP o para obtener la página, el RST no se enviaría. Se establecería una conexión completa.</p>
<p><img alt="" src="../img/syn_open.gif" /></p>
<h4 id="opciones-para-los-escaneos-switches-de-nmap">Opciones para los escaneos (switches de Nmap)</h4>
<p>Es imposible comentar todas las opciones que se pueden usar con Nmap, pero algunas de las más notorias serían:</p>
<ul>
<li><code>-T(0-5)</code>:  Esta es una opción para establecer la velocidad del escaneo. Los números van de 0 a 5, donde 5 es el más rápido y 0 es el más lento.</li>
</ul>
<p><img alt="" src="../img/opcionTnmap.png" /></p>
<ul>
<li>
<p><code>-A</code>: Esta opción hace que Nmap se esfuerce en identificar el sistema operativo, los servicios y las versiones de destino. También hace traceroute y <strong>aplica scripts NSE para detectar información adicional</strong>. Este es un escaneo bastante ruidoso ya que aplica muchos escaneos diferentes. Los scripts NSE aplicados son los de la configuración por defecto.</p>
</li>
<li>
<p><code>-v</code>: Mayor detalle. Esto nos dará información adicional en los datos generados por Nmap.</p>
</li>
<li>
<p><code>-sV</code>: Se utiliza para sondear activamente los puertos abiertos para intentar determinar qué servicio y versión están ejecutando. </p>
</li>
<li>
<p><code>-p</code>: Lista separada por comas de los puertos que se desean analizar. Una forma sencilla de definir solo unos pocos puertos para escanear o aumentar el alcance del escaneo a, por ejemplo, todos los puertos TCP disponibles.</p>
</li>
<li>
<p><code>-O</code>: Hacer que Nmap intente decidir qué tipo de sistema operativo es. El proceso de detección del sistema operativo puede ser bastante complejo, pero también bastante simple. Un factor simple para intentar decidir si se trata de un sistema operativo Windows o Unix es mirar el campo TTL (Tiempo de vida) en los paquetes que se envían desde el sistema operativo. Por lo general, Windows tiene un valor predeterminado de 128, mientras que Unix tiene un valor predeterminado de 64.</p>
</li>
<li>
<p><code>-Pn</code>: Fuerza la suposición de que el host está activo, omitiendo así la fase de descubrimiento del host.</p>
</li>
<li>
<p><code>-oA</code>: Guarda el resultado de salida de Nmap en formatos "normal", XML y grepable. No obstante, se puede concretar de forma específica el formato del archivo de salida:</p>
<ul>
<li>
<p><code>-oN</code>: redirige la salida normal a un nombre de archivo determinado</p>
</li>
<li>
<p><code>-oX</code>: Produce resultados en un formato XML limpio y guárdalos en un archivo determinado.</p>
</li>
<li>
<p><code>-oG</code>: Produce una salida "grepable" y la almacena en un archivo. Formato obsoleto ya que los usuarios ahora se están moviendo hacia salidas XML.</p>
</li>
</ul>
</li>
</ul>
<h3 id="scripts-en-nmap">Scripts en Nmap</h3>
<p>Nmap incorpora un potente sistema de scripts conocido como NSE (Nmap Scripting Engine) que permite a los usuarios extender las capacidades de Nmap usando los diversos scripts que incorpora (actualmente hay más de 500 disponibles) que permiten desde la detección avanzada de versiones a la explotación de vulnerabilidades, o creando nuevos scripts que podemos compartir con el resto de usuarios (para los script se utiliza el <a href="https://www.lua.org/">lenguaje de programación LUA</a>).</p>
<p>Para habilitar el uso de script en Nmap usamos la opción <code>-sC (nmap -sC &lt;objetivo&gt;)</code>. Con esta opción se seleccionarán todos los scripts NSE que pertenecen a la categoría predeterminada (<em>default</em>) y se ejecutarán contra los objetivos que indiquemos en el comando, por ejemplo:</p>
<pre><code class="language-sh">$ nmap -sC scanme.nmap.org
</code></pre>
<p>En este caso le estamos indicando que habilite el uso de scripts de la categoría predeterminada y Nmap selecciona los script a usar teniendo en cuenta los puertos que encuentra. En este caso se ejecutan los scripts <code>ssh-hostkey</code> y <code>http-title</code> como podemos ver en los resultados reportados:</p>
<pre><code class="language-sh">Starting Nmap 7.94SVN ( https://nmap.org ) at 2025-10-08 16:07 CEST
Nmap scan report for scanme.nmap.org (45.33.32.156)
Host is up (0.21s latency).
Other addresses for scanme.nmap.org (not scanned): 2600:3c01::f03c:91ff:fe18:bb2f
Not shown: 996 filtered tcp ports (no-response)
PORT      STATE SERVICE
22/tcp    open  ssh
| ssh-hostkey: 
|   1024 ac:00:a0:1a:82:ff:cc:55:99:dc:67:2b:34:97:6b:75 (DSA)
|   2048 20:3d:2d:44:62:2a:b0:5a:9d:b5:b3:05:14:c2:a6:b2 (RSA)
|   256 96:02:bb:5e:57:54:1c:4e:45:2f:56:4c:4a:24:b2:57 (ECDSA)
|_  256 33:fa:91:0f:e0:e1:7b:1f:6d:05:a2:b0:f1:54:41:56 (ED25519)
80/tcp    open  http
|_http-favicon: Nmap Project
|_http-title: Go ahead and ScanMe!
9929/tcp  open  nping-echo
31337/tcp open  Elite

Nmap done: 1 IP address (1 host up) scanned in 23.54 seconds
</code></pre>
<p>Los scripts en NSE se dividen en las siguientes categorías:</p>
<ul>
<li>
<p><code>auth</code>: Este tipo de Scripts permiten determinar credenciales de autenticación en el sistema objetivo, frecuentemente realizando ataques de fuerza bruta sencillos, algunos ejemplos de este tipo de scripts son ftp-anon, snmp-brute, http-auth, etc.</p>
</li>
<li>
<p><code>broadcast</code>: Este tipo de Scripts permiten determinar credenciales de autenticación en el sistema objetivo, frecuentemente realizando ataques de fuerza bruta sencillos, algunos ejemplos de este tipo de scripts son ftp-anon, snmp-brute, http-auth, etc.</p>
</li>
<li>
<p><code>brute</code>: esta categoría es para scripts que utilizan el sistema de fuerza bruta para averiguar las credenciales de usuario en un determinado servicio</p>
</li>
<li>
<p><code>default</code>: estos son los scripts que se ejecutan cuando se ejecuta la opción -sC. Se trata de un conjunto de scripts que ejecutan operaciones concretas tratando de capturar la mayor cantidad de información contra un objetivo, se trata de una categoría que debe ser evitada, ya que puede hacer mucho ruido contra un sistema remoto que tenga un IDS/IPS instalado, utilizando esta categoría, probablemente el escaneo no sea tan discreto como se espera.</p>
</li>
<li>
<p><code>discovery</code>: Estos scripts tratan de descubrir de forma activa servicios en el segmento de red tales como registros públicos, dispositivos SNMP, servicios de directorio, etc.</p>
</li>
<li>
<p><code>dos</code>: Intentan causar denegación de servicio sobre un servicio determinado.</p>
</li>
<li>
<p><code>exploit</code>: Tratan de detectar y explotar algún tipo de vulnerabilidad sobre el objetivo.</p>
</li>
<li>
<p><code>external</code>: Registran la información de un escaneo determinado en un recurso externo como por ejemplo un servicio de almacenamiento en internet, sin embargo es necesario ser cauteloso con este tipo de scripts ya que pueden enviar a una fuente externa la dirección IP del objetivo y del atacante.</p>
</li>
<li>
<p><code>fuzzer</code>: Estos Scripts envían información al servidor que es inesperada, incompleta o aleatoria, con el fin de detectar una posible vulnerabilidad en el servicio, sin embargo es costoso en términos de rendimiento del escaneo.</p>
</li>
<li>
<p><code>intrusive</code>: Son Scripts con un alto grado de ser perjudiciales para el sistema objetivo, ya que intenta utilizar recursos del sistema objetivo tales como proxys HTTP o dispositivos con SNMP habilitado.</p>
</li>
<li>
<p><code>malware</code>: Intentan determinar si el objetivo se encuentra infectado con malware o backdoors, algunos ejemplos de esta categoría de Scripts son: <code>smtp-strangeport</code> y <code>auth-spoof</code></p>
</li>
<li>
<p><code>safe</code>: Están diseñados para no afectar ni dañar el objetivo, simplemente tratan de capturar información que pueda ser sensible sin afectar el rendimiento u otros factores de la ejecución del servicio, ejemplos de este tipo de scripts pueden ser: ssh-hostkey o html-title </p>
</li>
<li>
<p><code>version</code>: Se trata de scripts que extienden el proceso de detección de versiones de servicios, están diseñados para ejecutarse solamente si el escaneo tiene la opción (Scan Version -sV)</p>
</li>
<li>
<p><code>vuln</code>: Chequean vulnerabilidades especificas de software y generan resultados solamente si dichas vulnerabilidades son encontradas, ejemplos de este tipo de scripts son: <code>realvnc-auth-bypass</code> y <code>afp-path-vuln</code></p>
</li>
</ul>
<p>Si la instalación de Nmap se ha realizado desde apt-get o dpkg, probablemente la ubicación de todos los scripts se encuentre en <code>/usr/share/nmap/scripts</code></p>
<h4 id="seleccion-de-scripts">Selección de scripts</h4>
<p>Podemos seleccionar el script que queremos ejecutar directamente indicando el fichero o podemos seleccionar todos los de una categoría o categorías.</p>
<h5 id="seleccionar-categorias">Seleccionar categorías</h5>
<pre><code class="language-sh">nmap -sV --script &lt;categoria&gt; &lt;objetivo&gt;
</code></pre>
<p>Por ejemplo:</p>
<pre><code class="language-sh">nmap -sV --script version scanme.nmap.org
</code></pre>
<p>Ejecutamos los script de la categoría version contra el objetivo scanme.nmap.org:</p>
<pre><code class="language-sh">nmap -sV --script=&quot;version,discovery&quot; scanme.nmap.org
</code></pre>
<p>Además de los script de la categoría version también se usarán los de la categoría discovery.</p>
<pre><code class="language-sh">nmap -sV --script &quot;not intrusive&quot; scanme.nmap.org
</code></pre>
<p>En este caso se ejecutarían todos los script excepto los de la categoría intrusive.</p>
<pre><code class="language-sh">nmap -sV --script &quot;(http-*) and not http-brute&quot; scanme.nmap.org
</code></pre>
<p>En este caso se ejecutarían todos los script http excepto http-brute.</p>
<h5 id="seleccion-de-script-especifico">Selección de script específico</h5>
<pre><code class="language-sh">nmap --script &lt;nombre de fichero&gt; &lt;objetivo&gt;
</code></pre>
<p>Por ejemplo:</p>
<pre><code class="language-sh">nmap --script http-title scanme.nmap.org
</code></pre>
<p>Se ejecucuta el script http-title contra el objetivo scanme.nmap.org (es posible indicar varios scripts separandolos por comas).</p>
<h4 id="actualizar-la-base-de-datos-de-scripts">Actualizar la base de datos de scripts</h4>
<pre><code class="language-sh">sudo nmap --script-updatedb
</code></pre>
<p>Se actualizarán los script contra la base de datos de Nmap y los script nuevos se guardaran en la ruta por defecto de nuestra instalación.</p>
<h4 id="demostracion-de-algunos-scripts">Demostración de algunos scripts</h4>
<ol>
<li>
<p>Comprobar las versiones de los servicios en los puertos abiertos</p>
<p><img alt="" src="../img/scripts1.png" /></p>
</li>
<li>
<p>A continuación se utiliza el script <code>ftp-anon</code> de la categoría <code>auth</code>. Este script nos permitirá saber si el acceso anónimo al servidor ftp está permitido.</p>
<p><img alt="" src="../img/scripts2.png" /></p>
</li>
<li>
<p>Con el script <code>http-defaults-accounts</code> se intenta determinar si el acceso con credenciales por defecto está habilitado en algunas aplicaciones web.</p>
<p><img alt="" src="../img/scripts3.png" /></p>
</li>
<li>
<p>El script <code>ftp-vsftpd-backdoor</code> corresponde a las categorías: exploit, intrusive, malware, vuln; este script busca la existencia de la puerta trasera (backdoor) reportada en <a href="https://www.incibe-cert.es/alerta-temprana/vulnerabilidades/cve-2011-2523">CVE-2011-2523</a> (una vulnerabilidad antigua pero con fines ilustrativos)</p>
<p><img alt="" src="../img/scripts4.png" /></p>
</li>
<li>
<p>Utilizando los scripts de la categoría <code>vuln</code> para descubrir la vlnerabilidad <a href="https://www.csirt-epn.edu.ec/servicios/vulnerabilidades/58-ms17-010">MS17-010 (Eternalblue)</a>, la que utilizó <em>Wannacry</em> en su día.</p>
<p><img alt="" src="../img/scripts5.jpg" /></p>
<p>Para haber buscado vulnerabilidad específicas de SMB, podíamos haber utilizado también:</p>
<p><code>sh
nmap -sV --script smb* &lt;Objetivo&gt;</code></p>
</li>
</ol>
<h2 id="evasion-de-firewall-con-nmap">Evasión de firewall con Nmap</h2>
<p>Como ya hemos visto, Nmap permite escaneos con diferentes parámetros del protocolo TCP, un pequeño resumen que tendremos en cuenta para esta sección es:</p>
<table>
<thead>
<tr>
<th>Escaneo</th>
<th>Flags TCP</th>
<th>Tamaño (Bytes)</th>
<th>TTL</th>
</tr>
</thead>
<tbody>
<tr>
<td>-sT</td>
<td>SYN</td>
<td>60</td>
<td>64</td>
</tr>
<tr>
<td>-sS (Stealth)</td>
<td>SYN</td>
<td>44</td>
<td>&lt;64</td>
</tr>
<tr>
<td>-sF (Fin)</td>
<td>FIN</td>
<td>40</td>
<td>&lt;64</td>
</tr>
<tr>
<td>-sN (Null)</td>
<td>NULL</td>
<td>40</td>
<td>&lt;64</td>
</tr>
<tr>
<td>-sX (Xmas)</td>
<td>FIN, PSH, URG</td>
<td>40</td>
<td>&lt;64</td>
</tr>
</tbody>
</table>
<h3 id="que-es-un-firewall-o-cortafuegos">¿Qué es un firewall o cortafuegos?</h3>
<p>Un cortafuegos es una medida de seguridad contra intentos de conexión no autorizados desde redes externas. Todo sistema de seguridad de cortafuegos se basa en un componente de software que supervisa el tráfico de red entre el cortafuegos y las conexiones de datos entrantes y decide cómo gestionar la conexión en función de las reglas establecidas.</p>
<p>Comprueba si los paquetes de red individuales se pasan, se ignoran o se bloquean. Este mecanismo está diseñado para evitar conexiones no deseadas que podrían ser 
potencialmente peligrosas.</p>
<h4 id="determinar-los-cortafuegos-y-sus-reglas">Determinar los cortafuegos y sus reglas</h4>
<p>Ya sabemos que cuando un puerto aparece como filtrado, puede deberse a varias razones. En la mayoría de los casos, los cortafuegos tienen ciertas reglas establecidas para manejar conexiones específicas. Los paquetes pueden ser descartados o rechazados. Los paquetes rechazados son ignorados y no se devuelve ninguna respuesta desde el host.</p>
<p>Esto es diferente para los paquetes rechazados que se devuelven con una bandera RST. Estos paquetes contienen diferentes tipos de códigos de error ICMP o no contienen nada en absoluto.</p>
<p>Tales errores pueden ser:</p>
<ul>
<li>Net Unreachable</li>
<li>Net Prohibited</li>
<li>Host Unreachable</li>
<li>Host Prohibited</li>
<li>Port Unreachable</li>
<li>Proto Unreachable</li>
</ul>
<p>El método de sondeo TCP ACK (-sA) de Nmap es mucho más difícil de filtrar para los cortafuegos y sistemas IDS/IPS que los sondeos regulares SYN (-sS) o Connect (-sT) porque sólo envían un paquete TCP con la bandera ACK. </p>
<p>Cuando un puerto está cerrado o abierto, el host debe responder con una bandera <code>RST</code>. A diferencia de las conexiones salientes, todos los intentos de conexión (con la bandera SYN ) procedentes de redes externas suelen ser bloqueados por los cortafuegos. Sin embargo, los paquetes con la bandera ACK a menudo pasan a través del cortafuegos porque éste no puede determinar si la conexión se estableció primero desde la red externa o desde la red interna.</p>
<h3 id="dockerfile">Dockerfile</h3>
<pre><code class="language-Dockerfile">FROM ubuntu:latest

ENV DEBIAN_FRONTEND=noninteractive

# Install necessary packages, including iproute2
RUN apt-get update &amp;&amp; \
    apt-get install -y iproute2 iputils-ping curl tcpdump iptables nginx openssh-server &amp;&amp; \
    rm -rf /var/lib/apt/lists/* &amp;&amp; \
    echo &quot;PermitRootLogin yes&quot; &gt;&gt; /etc/ssh/sshd_config

RUN mkdir /var/run/sshd


RUN echo 'root:root' | chpasswd

EXPOSE 80 22

CMD [&quot;sh&quot;, &quot;-c&quot;, &quot;service nginx start &amp;&amp; /usr/sbin/sshd -D&quot;]
</code></pre>
<pre><code class="language-bash">docker build -t nmap-demo .

docker run --privileged -d -p 8080:80 -p 2220:22 --name nmap-demo-c nmap-demo
</code></pre>
<h3 id="bypass-del-bloqueo-de-paquetes-syn">Bypass del bloqueo de paquetes SYN</h3>
<pre><code class="language-bash">iptables -I INPUT -p tcp --tcp-flags ALL SYN -j REJECT --reject-with tcp-reset

nmap -p22,80 -sT

sudo nmap -p22,80 -sS

sudo nmap -p22,80 -sX
</code></pre>
<h3 id="bypass-del-bloqueo-por-tamano-de-paquete-con-stealth-scan">Bypass del bloqueo por tamaño de paquete con Stealth scan</h3>
<pre><code class="language-bash">iptables -F INPUT

iptables -I INPUT -p tcp -m length --length 60 -j REJECT --reject-with tcp-reset

nmap -p22,80 -sT

sudo nmap -p22,80 -sS

iptables -nvL INPUT

iptables -I INPUT -p tcp -m length --length 44 -j REJECT --reject-with tcp-reset
iptables -I INPUT -p tcp -m length --length 40 -j REJECT --reject-with tcp-reset

nmap -p22,80 -sT

sudo nmap -p22,80 -sX

sudo nmap -p22,80 --data-length 41 

iptables -I INPUT -p tcp -m length --length 1:150 -j REJECT --reject-with tcp-reset
</code></pre>
<h3 id="bypass-de-bloqueo-por-filtrado-de-puerto-de-origen">Bypass de bloqueo por filtrado de puerto de origen</h3>
<pre><code class="language-bash">iptables -I INPUT -p tcp --sport 11222 -j ACCEPT
iptables -A INPUT -p tcp -j REJECT --reject-with tcp-reset

sudo nmap -p22,80 -g 11222
</code></pre>
<h3 id="bypass-de-bloqueo-por-filtrado-de-direcciones-mac-mac-spoofing">Bypass de bloqueo por filtrado de direcciones MAC (MAC spoofing)</h3>
<pre><code class="language-bash">iptables -I INPUT -p tcp -m mac --mac-source &quot;73:3b:3a:98:fc:4d&quot; -j ACCEPT
iptables -A INPUT -p tcp -j REJECT --reject-with tcp-reset

sudo nmap -p22,80 --spoof-mac 73:3b:3a:98:fc:4d
</code></pre>
<h3 id="bypass-de-bloqueo-por-filtrado-de-direcciones-ip-ip-spoofing">Bypass de bloqueo por filtrado de direcciones IP (IP spoofing)</h3>
<pre><code class="language-bash">.2

sudo nmap -p22,80 -e eth0 -S x.x.x.x -sS x.x.x.x
</code></pre>







  
  






                
              </article>
            </div>
          
          
  <script>var tabs=__md_get("__tabs");if(Array.isArray(tabs))e:for(var set of document.querySelectorAll(".tabbed-set")){var labels=set.querySelector(".tabbed-labels");for(var tab of tabs)for(var label of labels.getElementsByTagName("label"))if(label.innerText.trim()===tab){var input=document.getElementById(label.htmlFor);input.checked=!0;continue e}}</script>

<script>var target=document.getElementById(location.hash.slice(1));target&&target.name&&(target.checked=target.name.startsWith("__tabbed_"))</script>
        </div>
        
          <button type="button" class="md-top md-icon" data-md-component="top" hidden>
  
  <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M13 20h-2V8l-5.5 5.5-1.42-1.42L12 4.16l7.92 7.92-1.42 1.42L13 8z"/></svg>
  Volver al principio
</button>
        
      </main>
      
        <footer class="md-footer">
  
    
  
  <div class="md-footer-meta md-typeset">
    <div class="md-footer-meta__inner md-grid">
      <div class="md-copyright">
  
  
    Made with
    <a href="https://squidfunk.github.io/mkdocs-material/" target="_blank" rel="noopener">
      Material for MkDocs
    </a>
  
</div>
      
    </div>
  </div>
</footer>
      
    </div>
    <div class="md-dialog" data-md-component="dialog">
      <div class="md-dialog__inner md-typeset"></div>
    </div>
    
    
    
      
      <script id="__config" type="application/json">{"base": "../..", "features": ["navigation.tabs", "toc.integrate", "navigation.expand", "navigation.top", "navigation.indexes", "content.tabs.link", "content.code.annotate", "content.code.copy", "navigation.footer"], "search": "../../assets/javascripts/workers/search.973d3a69.min.js", "tags": null, "translations": {"clipboard.copied": "Copiado al portapapeles", "clipboard.copy": "Copiar al portapapeles", "search.result.more.one": "1 m\u00e1s en esta p\u00e1gina", "search.result.more.other": "# m\u00e1s en esta p\u00e1gina", "search.result.none": "No se encontraron documentos", "search.result.one": "1 documento encontrado", "search.result.other": "# documentos encontrados", "search.result.placeholder": "Teclee para comenzar b\u00fasqueda", "search.result.term.missing": "Falta", "select.version": "Seleccionar versi\u00f3n"}, "version": null}</script>
    
    
      <script src="../../assets/javascripts/bundle.f55a23d4.min.js"></script>
      
    
  </body>
</html>